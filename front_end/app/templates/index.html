<!DOCTYPE html>
<html lang="en" class="full">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>{{title}} - LocalFeel</title>

    <!-- Bootstrap core CSS -->
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../static/css/the-big-picture.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="../static/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">LocalFeel</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#contact">Contact</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

<br><br>

    <div class="container">

      <div class="starter-template">
        <h1>LocalFeel</h1>
        <p class="lead">New to town?  LocalFeel helps you find the places locals love.</p>
	  <h4>Find a bar near</h4>
      <div class="row">
        <div class="col-xs-4">
          <input id="text_address" type="text" name="address" class="form-control" placeholder="Street address">
        </div>
        <div class="col-xs-1">
          <input id="button_go" type="submit" name="my-form" value="Go" class="form-control">
        </div>
      </div>
	</br></br>

      </div>
    <div id="results_message_div" class="hidden">
      <h4 id="results_message">Message</h4>
    </div>
    <div id="results_table_div" class="hidden">
      <div class="container-fluid; img-rounded" style="background: white;">
        <table class="table table-hover" id="results_table">
        <tr><th>Bar</th><th>Category</th><th>Address</th><th>Yelp Rating</th><th>Local Rating</th></tr>
          <tr id="results_row" class="hidden">
            <td id="bar_name">bar_name</td>
            <td id="bar_category_1">bar_category_1</td>
            <td id="bar_address">bar_address</td>
            <td id="bar_rating">bar_rating</td>
            <td id="local_rating">local_rating</td>
          </tr>
        </table>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>

    </div><!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../static/js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
<script>
$('#button_go').on('click',function(event){
  console.log('click');
  $('#results_message_div').addClass('hidden');
  $('#results_table_div').addClass('hidden');
  var address = $('#text_address').val();
  if (address == '') {
    console.log('no address entered');
    $('#results_message').text('Did you forget the address?');
    $('#results_message_div').removeClass('hidden');
    return
  }
  console.log($(address));
  $.getJSON('consult?address=' + address, function(data) {
    console.log(data);
    if (data == null) {
      console.log('back-end error');
      $('#results_message').text("We couldn't process your address.  Oops, that's embarassing.");
      $('#results_message_div').removeClass('hidden');
      return
    }
    console.log("Number of results found: ", Object.keys(data).length);
    results = Object.keys(data).length;
    if (results <= 0) {
      console.log('no results found');
      $('#results_message').text('No results found for that address.  How about going to the Marina?');
      $('#results_message_div').removeClass('hidden');
      return
    }
    $('#results_message_div').addClass('hidden');
    // Remove all previous results from table
    var rows = $('#results_table').find($(".temp"));
    for (var index=0; index < rows.length; index+=1) {
       rows[index].remove();
    } 
    // Make table visible and populate table with results
    $('#results_table_div').removeClass('hidden');
    for (var item in data) {
      var new_row = $('#results_row').clone();
      $(new_row).addClass('temp');
      for (var key in data[item]) {
        //console.log(key);
        $(new_row).find("#"+key).text(data[item][key])
      }
      $(new_row).removeClass('hidden');
      $('#results_table').append(new_row);
    }
  });
});
$(document).keypress(function(e) {
  if(e.which == 13) {
    console.log('Enter pressed');
    $('#button_go').click();
  }
});
</script>
